<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClientMeet ‚Äî –£—á—ë—Ç –≤—Å—Ç—Ä–µ—á</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            color: #495057;
            font-weight: 700;
        }
        
        .logo p {
            font-size: 1rem;
            color: #6c757d;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .view-toggle {
            display: flex;
            gap: 8px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .view-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.2s ease;
        }
        
        .view-btn:hover {
            background: #e9ecef;
        }
        
        .view-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: none;
        }
        
        .settings-btn {
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .settings-btn:hover {
            transform: rotate(90deg);
            background: #e9ecef;
        }
        
        .settings-btn svg {
            width: 20px;
            height: 20px;
            fill: #6c757d;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            background: #c82333;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .welcome-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .welcome-section h2 {
            color: #495057;
            font-size: 1.5rem;
        }
        
        /* –≠–∫—Ä–∞–Ω—ã –≤—Ö–æ–¥–∞ */
        .login-screen, .pin-screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 40px auto;
            max-width: 800px;
            width: 90%;
        }
        
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .user-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid #e0e6ed;
            border-radius: 15px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1rem;
            position: relative;
        }
        
        .user-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, #e8edf5 0%, #a8b6d9 100%);
        }
        
        .user-card.locked::after {
            content: 'üîí';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
        }
        
        .user-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .pin-form {
            text-align: center;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .pin-form input {
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
        }
        
        .pin-form input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }
        
        .btn:hover {
            transform: scale(1.05);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .meeting-form {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* –§–∏–ª—å—Ç—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ */
        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #495057;
            font-weight: 600;
        }
        
        .inline-filter {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .inline-filter label {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }
        
        .inline-filter input[type="date"],
        .inline-filter select,
        .inline-filter input[type="search"] {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            min-width: 140px;
        }
        
        .clear-filter {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 2px;
            border-radius: 4px;
        }
        
        .clear-filter:hover {
            background: #e9ecef;
            color: #dc3545;
        }
        
        .meetings-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .meetings-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .meetings-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .meetings-table tr:last-child td {
            border-bottom: none;
        }
        
        .meetings-table tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .edit-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #ffc107;
            color: #212529;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
            font-weight: bold;
        }
        
        .meetings-table tr:hover .edit-btn {
            opacity: 1;
        }
        
        .edit-btn:hover {
            background: #e0a800;
            transform: translateY(-50%) scale(1.1);
        }
        
        .error {
            color: #dc3545;
            margin: 10px 0;
            font-weight: 600;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .modal-header h3 {
            color: #495057;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .calendar-day {
            min-height: 100px;
            padding: 8px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
            position: relative;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .calendar-day.other-month {
            background: #f8f9fa;
            color: #6c757d;
        }
        
        .calendar-day.today {
            background: #e3f2fd !important;
            border-color: #2196f3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.3);
        }
        
        .calendar-day.weekend {
            background: #fff8e1;
        }
        
        .calendar-day.weekend.other-month {
            background: #fdf6ec;
        }
        
        .calendar-day-number {
            font-weight: bold;
            margin-bottom: 6px;
            display: block;
        }
        
        .calendar-meeting {
            font-size: 0.75rem;
            padding: 3px 6px;
            border-radius: 4px;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
            font-weight: 500;
            text-shadow: 0 1px 1px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        
        .calendar-meeting:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            z-index: 1001;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .settings-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-header h3 {
            font-size: 1.3rem;
        }
        
        .close-settings {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .settings-section {
            padding: 20px;
        }
        
        .settings-item {
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .settings-header-item {
            padding: 15px 20px;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #495057;
        }
        
        .settings-header-item:hover {
            background: #e9ecef;
        }
        
        .settings-content {
            padding: 20px;
            display: none;
        }
        
        .settings-content.active {
            display: block;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */
        .color-1 { background: #e74c3c; }    /* –ö—Ä–∞—Å–Ω—ã–π */
        .color-2 { background: #3498db; }    /* –°–∏–Ω–∏–π */
        .color-3 { background: #2ecc71; }    /* –ó–µ–ª–µ–Ω—ã–π */
        .color-4 { background: #f39c12; }    /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
        .color-5 { background: #9b59b6; }    /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        .color-6 { background: #1abc9c; }    /* –ë–∏—Ä—é–∑–æ–≤—ã–π */
        .color-7 { background: #e67e22; }    /* –¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π */
        .color-8 { background: #34495e; }    /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π */
        .color-9 { background: #16a085; }    /* –¢–µ–º–Ω–æ-–±–∏—Ä—é–∑–æ–≤—ã–π */
        .color-10 { background: #d35400; }   /* –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π */
        .color-11 { background: #27ae60; }   /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π */
        .color-12 { background: #8e44ad; }   /* –¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è */
        @keyframes todayHighlight {
            0% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(33, 150, 243, 0); }
            100% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0); }
        }
        
        .calendar-day.today.highlight {
            animation: todayHighlight 1.5s ease-in-out;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–∞—Ç—ã (–Ω–∞—Ç–∏–≤–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π) */
        input[type="date"] {
            position: relative;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        
        /* –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ */
        .analytics-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }
        
        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .analytics-header h3 {
            color: #495057;
            font-size: 1.5rem;
        }
        
        .analytics-toggle {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 5px;
        }
        
        .analytics-toggle:hover {
            background: #e9ecef;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .analytics-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .analytics-card h4 {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .analytics-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #495057;
        }
        
        .employee-stats {
            margin-top: 20px;
        }
        
        .employee-stats h4 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .employee-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        
        .employee-card .name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .employee-card .meetings {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –±–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏ */
        .add-meeting-toggle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .add-meeting-toggle:hover {
            transform: translateY(-2px);
        }
        
        .add-meeting-toggle span {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .add-meeting-toggle svg {
            width: 16px;
            height: 16px;
            fill: white;
            transition: transform 0.3s ease;
        }
        
        .add-meeting-toggle.active svg {
            transform: rotate(180deg);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            display: none;
        }
        
        .sync-status.syncing {
            background: rgba(255,193,7,0.9);
        }
        
        .sync-status.synced {
            background: rgba(40,167,69,0.9);
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            header {
                padding: 10px 15px;
            }
            
            .logo h1 {
                font-size: 1.4rem;
            }
            
            .view-toggle {
                gap: 4px;
            }
            
            .view-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .users-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 5px;
                font-size: 0.75rem;
            }
            
            .settings-panel {
                width: 100%;
                right: -100%;
            }
            
            .settings-panel.open {
                right: 0;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .inline-filter {
                width: 100%;
                justify-content: flex-start;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .users-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .calendar-day {
                min-height: 60px;
            }
            
            .employee-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header id="appHeader" style="display: none;">
            <div class="logo">
                <h1>ClientMeet</h1>
                <p>–£—á—ë—Ç –≤—Å—Ç—Ä–µ—á —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
            </div>
            <div class="header-actions">
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('list')">–°–ø–∏—Å–æ–∫</button>
                    <button class="view-btn" onclick="switchView('calendar')">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
                    <button class="view-btn" id="analyticsBtn" style="display: none;" onclick="switchView('analytics')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
                </div>
                <button class="settings-btn" id="settingsBtn" style="display: none;" onclick="toggleSettings()">
                    <svg viewBox="0 0 24 24">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                </button>
                <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
            <div id="loginScreen" class="login-screen">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –≤—Ö–æ–¥–∞</h2>
                <div class="users-grid" id="usersGrid">
                    <!-- –ò–∫–æ–Ω–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω PIN -->
            <div id="pinScreen" class="pin-screen" style="display: none;">
                <h2>–í–≤–µ–¥–∏—Ç–µ PIN-–∫–æ–¥</h2>
                <div class="pin-form">
                    <input type="password" id="pinInput" placeholder="****" maxlength="4" inputmode="numeric">
                    <div id="pinError" class="error" style="display: none;"></div>
                    <button class="btn" onclick="verifyPin()">–í–æ–π—Ç–∏</button>
                    <button class="btn btn-secondary" onclick="cancelPin()" style="margin-left: 10px;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div id="dashboard" style="display: none;">
                <div class="welcome-section">
                    <h2 id="welcomeMessage">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName"></span>!</h2>
                </div>
                
                <div id="listView">
                    <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –±–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏ -->
                    <button class="add-meeting-toggle" onclick="toggleAddMeetingForm()">
                        <span>
                            <svg viewBox="0 0 24 24">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤—Å—Ç—Ä–µ—á—É
                        </span>
                        <svg viewBox="0 0 24 24">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                    </button>
                    
                    <div class="meeting-form" id="meetingForm" style="display: none;">
                        <div class="form-group">
                            <label for="clientName">–ö–ª–∏–µ–Ω—Ç</label>
                            <input type="text" id="clientName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏">
                        </div>
                        <div class="form-group">
                            <label for="meetingDate">–î–∞—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏</label>
                            <input type="date" id="meetingDate">
                        </div>
                        <div class="form-group">
                            <label for="meetingNotes">–ó–∞–º–µ—Ç–∫–∏ / –†–µ–∑—É–ª—å—Ç–∞—Ç</label>
                            <textarea id="meetingNotes" placeholder="–û–ø–∏—à–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å—Ç—Ä–µ—á–∏, –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç.–¥."></textarea>
                        </div>
                        <button class="btn" onclick="addMeeting()">–î–æ–±–∞–≤–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É</button>
                    </div>
                    
                    <!-- –í—Å—Ç—Ä–µ—á–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ -->
                    <div class="section-header">
                        <h3 class="section-title">–í–∞—à–∏ –≤—Å—Ç—Ä–µ—á–∏</h3>
                        <div class="inline-filter">
                            <label for="searchClient">–ü–æ–∏—Å–∫:</label>
                            <input type="search" id="searchClient" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏...">
                            <button class="clear-filter" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">‚úï</button>
                        </div>
                        <div class="inline-filter">
                            <label for="filterDate">–î–∞—Ç–∞:</label>
                            <input type="date" id="filterDate">
                            <button class="clear-filter" onclick="clearDateFilter()" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä">‚úï</button>
                        </div>
                        <div class="inline-filter" id="employeeFilter" style="display: none;">
                            <label for="filterEmployee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
                            <select id="filterEmployeeSelect">
                                <option value="">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                            </select>
                            <button class="clear-filter" onclick="clearEmployeeFilter()" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä">‚úï</button>
                        </div>
                    </div>
                    
                    <table class="meetings-table">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–ó–∞–º–µ—Ç–∫–∏</th>
                                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                            </tr>
                        </thead>
                        <tbody id="meetingsList">
                            <!-- –í—Å—Ç—Ä–µ—á–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
                
                <div id="calendarView" class="calendar" style="display: none;">
                    <div class="calendar-header">
                        <h3 id="calendarTitle">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
                        <div class="calendar-controls">
                            <button class="btn" onclick="toggleWeekends()">–°–∫—Ä—ã—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ</button>
                            <button class="btn" onclick="goToToday()">–°–µ–≥–æ–¥–Ω—è</button>
                            <button class="btn" onclick="changeMonth(-1)">‚ùÆ</button>
                            <button class="btn" onclick="changeMonth(1)">‚ùØ</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
                
                <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –Ø—Ä–æ—Å–ª–∞–≤–∞ -->
                <div id="analyticsView" class="analytics-section" style="display: none;">
                    <div class="analytics-header">
                        <h3>–ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                        <button class="analytics-toggle" onclick="refreshAnalytics()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                    <div class="analytics-grid" id="analyticsGrid">
                        <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <button class="close-settings" onclick="toggleSettings()">&times;</button>
        </div>
        <div class="settings-section">
            <div class="settings-item">
                <div class="settings-header-item" onclick="toggleSettingsSection('pin')">
                    <span>–°–º–µ–Ω–∞ PIN-–∫–æ–¥–∞</span>
                    <span>‚ñº</span>
                </div>
                <div class="settings-content" id="pinSettings">
                    <div class="form-group">
                        <label for="newPin">–ù–æ–≤—ã–π PIN-–∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã)</label>
                        <input type="password" id="newPin" maxlength="4" inputmode="numeric" placeholder="****">
                    </div>
                    <div class="form-group">
                        <label for="confirmPin">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ PIN-–∫–æ–¥</label>
                        <input type="password" id="confirmPin" maxlength="4" inputmode="numeric" placeholder="****">
                    </div>
                    <button class="btn btn-success" onclick="changePin()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PIN</button>
                    <div id="pinChangeMessage" class="error" style="margin-top: 10px; display: none;"></div>
                </div>
            </div>
            
            <div class="settings-item">
                <div class="settings-header-item" onclick="toggleSettingsSection('users')">
                    <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</span>
                    <span>‚ñº</span>
                </div>
                <div class="settings-content" id="usersSettings">
                    <div class="form-group">
                        <label for="newUserName">–ò–º—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                        <input type="text" id="newUserName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="form-group">
                        <label for="newUserRole">–†–æ–ª—å</label>
                        <select id="newUserRole">
                            <option value="user">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
                            <option value="admin">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newUserPin">PIN-–∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="password" id="newUserPin" maxlength="4" inputmode="numeric" placeholder="****">
                    </div>
                    <button class="btn btn-success" onclick="addUser()">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 15px;">–¢–µ–∫—É—â–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h4>
                    <div class="users-management" id="usersManagement">
                        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="settingsOverlay" onclick="toggleSettings()"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É</h3>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="editClientName">–ö–ª–∏–µ–Ω—Ç</label>
                <input type="text" id="editClientName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏">
            </div>
            <div class="form-group">
                <label for="editMeetingDate">–î–∞—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏</label>
                <input type="date" id="editMeetingDate">
            </div>
            <div class="form-group">
                <label for="editMeetingNotes">–ó–∞–º–µ—Ç–∫–∏ / –†–µ–∑—É–ª—å—Ç–∞—Ç</label>
                <textarea id="editMeetingNotes" placeholder="–û–ø–∏—à–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å—Ç—Ä–µ—á–∏, –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç.–¥."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="saveEditedMeeting()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-danger" onclick="deleteMeeting()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
    <div class="sync-status" id="syncStatus">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>

    <script>
        // üî• –í–ê–®–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE üî•
        const firebaseConfig = {
            apiKey: "AIzaSyBHEIl9q8FsVAe8xDcge-5GD0iboJosIHM",
            authDomain: "clientmeet-2gis.firebaseapp.com",
            databaseURL: "https://clientmeet-2gis-default-rtdb.firebaseio.com",
            projectId: "clientmeet-2gis",
            storageBucket: "clientmeet-2gis.firebasestorage.app",
            messagingSenderId: "1059893544653",
            appId: "1:1059893544653:web:ce91f40e0a18394ddbcb84"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ Firebase)
        let USERS = [];
        let currentUser = null;
        let currentEditingMeetingId = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let hideWeekends = false;
        let pendingUserId = null;
        
        const USER_COLORS = [
            'color-1', 'color-2', 'color-3', 'color-4', 'color-5', 
            'color-6', 'color-7', 'color-8', 'color-9', 'color-10',
            'color-11', 'color-12'
        ];
        
        // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        const syncStatus = document.getElementById('syncStatus');
        
        function showSyncStatus(status) {
            if (status === 'syncing') {
                syncStatus.textContent = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                syncStatus.className = 'sync-status syncing';
                syncStatus.style.display = 'block';
            } else if (status === 'synced') {
                syncStatus.textContent = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
                syncStatus.className = 'sync-status synced';
                setTimeout(() => {
                    syncStatus.style.display = 'none';
                }, 2000);
            }
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ò–ó FIREBASE ==========
        
        function loadUsersFromFirebase() {
            return new Promise((resolve) => {
                const usersRef = database.ref('users');
                usersRef.once('value', (snapshot) => {
                    const usersData = snapshot.val();
                    if (usersData) {
                        USERS = Object.values(usersData);
                        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É –Ø—Ä–æ—Å–ª–∞–≤–∞ –µ—Å—Ç—å PIN –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        const yaroslav = USERS.find(u => u.name === '–Ø—Ä–æ—Å–ª–∞–≤');
                        if (yaroslav && !yaroslav.pin) {
                            yaroslav.pin = '1234';
                            saveUsersToFirebase();
                        }
                    } else {
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                        USERS = [
                            { id: 1, name: '–Ø—Ä–æ—Å–ª–∞–≤', role: 'admin', pin: '1234' },
                            { id: 2, name: '–ù–∏–∫–∏—Ç–∞', role: 'user', pin: null },
                            { id: 3, name: '–ò—Ä–∏–Ω–∞', role: 'user', pin: null },
                            { id: 4, name: '–ú–∏—à–∞', role: 'user', pin: null },
                            { id: 5, name: '–î–∏–º–∞', role: 'user', pin: null },
                            { id: 6, name: '–õ–µ—Ä–∞', role: 'user', pin: null }
                        ];
                        saveUsersToFirebase();
                    }
                    resolve();
                });
            });
        }
        
        function saveUsersToFirebase() {
            const usersObj = {};
            USERS.forEach(user => {
                usersObj[user.id] = user;
            });
            database.ref('users').set(usersObj);
            showSyncStatus('synced');
        }
        
        function getMeetingsFromFirebase() {
            return new Promise((resolve) => {
                const meetingsRef = database.ref('meetings');
                meetingsRef.once('value', (snapshot) => {
                    const meetingsData = snapshot.val();
                    const meetings = meetingsData ? Object.values(meetingsData) : [];
                    resolve(meetings);
                });
            });
        }
        
        function saveMeetingToFirebase(meeting) {
            showSyncStatus('syncing');
            const meetingsRef = database.ref('meetings');
            meetingsRef.push(meeting).then(() => {
                showSyncStatus('synced');
            });
        }
        
        function updateMeetingInFirebase(meetingId, updatedMeeting) {
            showSyncStatus('syncing');
            const meetingsRef = database.ref('meetings');
            // –ù–∞–π–¥–µ–º –∫–ª—é—á –≤—Å—Ç—Ä–µ—á–∏ –ø–æ ID
            meetingsRef.once('value', (snapshot) => {
                const meetings = snapshot.val();
                if (meetings) {
                    const key = Object.keys(meetings).find(k => meetings[k].id == meetingId);
                    if (key) {
                        meetingsRef.child(key).update(updatedMeeting).then(() => {
                            showSyncStatus('synced');
                        });
                    }
                }
            });
        }
        
        function deleteMeetingFromFirebase(meetingId) {
            showSyncStatus('syncing');
            const meetingsRef = database.ref('meetings');
            meetingsRef.once('value', (snapshot) => {
                const meetings = snapshot.val();
                if (meetings) {
                    const key = Object.keys(meetings).find(k => meetings[k].id == meetingId);
                    if (key) {
                        meetingsRef.child(key).remove().then(() => {
                            showSyncStatus('synced');
                        });
                    }
                }
            });
        }
        
        // ========== –ü–û–õ–ù–´–ô –°–ë–†–û–° –°–û–°–¢–û–Ø–ù–ò–Ø ==========
        function resetAppState() {
            // –°–±—Ä–æ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            currentUser = null;
            currentEditingMeetingId = null;
            currentMonth = new Date().getMonth();
            currentYear = new Date().getFullYear();
            hideWeekends = false;
            pendingUserId = null;
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            const clientName = document.getElementById('clientName');
            const meetingNotes = document.getElementById('meetingNotes');
            const searchClient = document.getElementById('searchClient');
            const filterDate = document.getElementById('filterDate');
            const filterEmployeeSelect = document.getElementById('filterEmployeeSelect');
            
            if (clientName) clientName.value = '';
            if (meetingNotes) meetingNotes.value = '';
            if (searchClient) searchClient.value = '';
            if (filterDate) filterDate.value = '';
            if (filterEmployeeSelect) filterEmployeeSelect.value = '';
            
            // –°–∫—Ä—ã—Ç–∏–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–µ–π—Å—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏
            const meetingForm = document.getElementById('meetingForm');
            const addMeetingButton = document.querySelector('.add-meeting-toggle');
            if (meetingForm && addMeetingButton) {
                meetingForm.style.display = 'none';
                addMeetingButton.classList.remove('active');
            }
            
            // –°–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            const editModal = document.getElementById('editModal');
            const settingsPanel = document.getElementById('settingsPanel');
            const settingsOverlay = document.getElementById('settingsOverlay');
            const pinScreen = document.getElementById('pinScreen');
            const loginScreen = document.getElementById('loginScreen');
            const dashboard = document.getElementById('dashboard');
            const appHeader = document.getElementById('appHeader');
            
            if (editModal) editModal.style.display = 'none';
            if (settingsPanel) settingsPanel.classList.remove('open');
            if (settingsOverlay) settingsOverlay.classList.remove('active');
            if (pinScreen) pinScreen.style.display = 'none';
            if (loginScreen) loginScreen.style.display = 'none';
            if (dashboard) dashboard.style.display = 'none';
            if (appHeader) appHeader.style.display = 'none';
            
            // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ - –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const listViewBtn = document.querySelector('.view-btn:nth-child(1)');
            if (listViewBtn) {
                listViewBtn.classList.add('active');
            }
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            const listView = document.getElementById('listView');
            const calendarView = document.getElementById('calendarView');
            const analyticsView = document.getElementById('analyticsView');
            
            if (listView) listView.style.display = 'none';
            if (calendarView) calendarView.style.display = 'none';
            if (analyticsView) analyticsView.style.display = 'none';
        }
        
        // ========== –§–£–ù–ö–¶–ò–ò –ù–ï–ß–ï–¢–ö–û–ì–û –ü–û–ò–°–ö–ê ==========
        
        // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞ (—Ä–µ–¥–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
        function levenshteinDistance(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;
            
            const matrix = [];
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã
            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    const cost = b[i - 1] === a[j - 1] ? 0 : 1;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,     // —É–¥–∞–ª–µ–Ω–∏–µ
                        matrix[i][j - 1] + 1,     // –≤—Å—Ç–∞–≤–∫–∞
                        matrix[i - 1][j - 1] + cost // –∑–∞–º–µ–Ω–∞
                    );
                }
            }
            
            return matrix[b.length][a.length];
        }
        
        // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
        function normalizeString(str) {
            return str.toLowerCase().trim().replace(/\s+/g, ' ');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –Ω–µ—á–µ—Ç–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
        function fuzzySearch(searchTerm, target, threshold = 0.6) {
            if (!searchTerm.trim()) return true;
            
            const normalizedSearch = normalizeString(searchTerm);
            const normalizedTarget = normalizeString(target);
            
            // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if (normalizedTarget.includes(normalizedSearch)) {
                return true;
            }
            
            // –†–∞—Å—á–µ—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞
            const distance = levenshteinDistance(normalizedSearch, normalizedTarget);
            const maxLength = Math.max(normalizedSearch.length, normalizedTarget.length);
            const similarity = 1 - (distance / maxLength);
            
            return similarity >= threshold;
        }
        
        // ========== –§–£–ù–ö–¶–ò–ò –ê–ù–ê–õ–ò–¢–ò–ö–ò ==========
        
        async function calculateAnalytics() {
            const meetings = await getMeetingsFromFirebase();
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalMeetings = meetings.length;
            const recentMeetings = meetings.filter(m => new Date(m.date) >= thirtyDaysAgo).length;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
            const employeeStats = {};
            USERS.forEach(user => {
                employeeStats[user.id] = {
                    name: user.name,
                    meetings: meetings.filter(m => m.userId === user.id).length
                };
            });
            
            // –°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
            let mostActiveEmployee = null;
            let maxMeetings = 0;
            Object.values(employeeStats).forEach(stat => {
                if (stat.meetings > maxMeetings) {
                    maxMeetings = stat.meetings;
                    mostActiveEmployee = stat.name;
                }
            });
            
            return {
                totalMeetings,
                recentMeetings,
                employeeStats,
                mostActiveEmployee,
                maxMeetings
            };
        }
        
        async function renderAnalytics() {
            const analytics = await calculateAnalytics();
            const analyticsGrid = document.getElementById('analyticsGrid');
            
            if (!analyticsGrid) return;
            
            analyticsGrid.innerHTML = `
                <div class="analytics-card">
                    <h4>–í—Å–µ–≥–æ –≤—Å—Ç—Ä–µ—á</h4>
                    <div class="value">${analytics.totalMeetings}</div>
                </div>
                <div class="analytics-card">
                    <h4>–í—Å—Ç—Ä–µ—á –∑–∞ 30 –¥–Ω–µ–π</h4>
                    <div class="value">${analytics.recentMeetings}</div>
                </div>
                <div class="analytics-card">
                    <h4>–°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π</h4>
                    <div class="value">${analytics.mostActiveEmployee || '‚Äî'}</div>
                </div>
                <div class="analytics-card">
                    <h4>–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h4>
                    <div class="value">${USERS.length}</div>
                </div>
                
                <div class="employee-stats">
                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</h4>
                    <div class="employee-grid">
                        ${Object.values(analytics.employeeStats).map(stat => `
                            <div class="employee-card">
                                <div class="name">${stat.name}</div>
                                <div class="meetings">${stat.meetings} –≤—Å—Ç—Ä–µ—á</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function refreshAnalytics() {
            renderAnalytics();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            await loadUsersFromFirebase();
            renderUsers();
            loadCurrentUser();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ realtime-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è –≤—Å—Ç—Ä–µ—á
            const meetingsRef = database.ref('meetings');
            meetingsRef.on('value', (snapshot) => {
                // –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
                if (document.getElementById('dashboard').style.display !== 'none') {
                    renderMeetings();
                    renderCalendar();
                    if (currentUser && currentUser.role === 'admin') {
                        renderAnalytics();
                    }
                }
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ realtime-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const usersRef = database.ref('users');
            usersRef.on('value', (snapshot) => {
                const usersData = snapshot.val();
                if (usersData) {
                    USERS = Object.values(usersData);
                    renderUsers();
                    if (currentUser && currentUser.role === 'admin') {
                        renderUsersManagement();
                    }
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            const editModal = document.getElementById('editModal');
            if (editModal) {
                editModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeEditModal();
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞
            const filterDate = document.getElementById('filterDate');
            const filterEmployeeSelect = document.getElementById('filterEmployeeSelect');
            const searchClient = document.getElementById('searchClient');
            
            if (filterDate) filterDate.addEventListener('change', applyFilters);
            if (filterEmployeeSelect) filterEmployeeSelect.addEventListener('change', applyFilters);
            if (searchClient) searchClient.addEventListener('input', applyFilters);
        });
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function renderUsers() {
            const usersGrid = document.getElementById('usersGrid');
            if (!usersGrid) return;
            
            usersGrid.innerHTML = '';
            
            USERS.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                if (user.pin) {
                    userCard.className += ' locked';
                }
                userCard.innerHTML = `
                    <span class="user-icon">üë§</span>
                    ${user.name}
                `;
                userCard.onclick = () => loginUser(user);
                usersGrid.appendChild(userCard);
            });
        }
        
        // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–æ–ª–Ω—ã–º —Å–±—Ä–æ—Å–æ–º)
        function loginUser(user) {
            // –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
            resetAppState();
            
            if (user.pin) {
                // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω PIN
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('pinScreen').style.display = 'block';
                const pinInput = document.getElementById('pinInput');
                const pinError = document.getElementById('pinError');
                const pinScreenTitle = document.querySelector('.pin-screen h2');
                
                if (pinInput) {
                    pinInput.value = '';
                    pinInput.focus();
                }
                if (pinError) pinError.style.display = 'none';
                if (pinScreenTitle) {
                    pinScreenTitle.textContent = `–í–≤–µ–¥–∏—Ç–µ PIN-–∫–æ–¥ –¥–ª—è ${user.name}`;
                }
                
                pendingUserId = user.id;
            } else {
                // –í—Ö–æ–¥ –±–µ–∑ PIN
                setCurrentUser(user);
                showDashboard();
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ PIN (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function verifyPin() {
            const pinInput = document.getElementById('pinInput');
            const pinError = document.getElementById('pinError');
            
            if (!pinInput || !pinError) return;
            
            const user = USERS.find(u => u.id === pendingUserId);
            if (!user) {
                cancelPin();
                return;
            }
            
            if (pinInput.value === user.pin) {
                // –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ PIN
                resetAppState(); // –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
                setCurrentUser(user);
                showDashboard();
            } else {
                pinError.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π PIN-–∫–æ–¥!';
                pinError.style.display = 'block';
                pinInput.value = '';
                pinInput.focus();
            }
        }
        
        // –û—Ç–º–µ–Ω–∞ –≤–≤–æ–¥–∞ PIN
        function cancelPin() {
            pendingUserId = null;
            document.getElementById('pinScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function setCurrentUser(user) {
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadCurrentUser() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('pinScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('appHeader').style.display = 'flex';
            
            // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            const userName = document.getElementById('userName');
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (userName && welcomeMessage) {
                userName.textContent = currentUser.name;
                welcomeMessage.innerHTML = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName">${currentUser.name}</span>!`;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
            const settingsBtn = document.getElementById('settingsBtn');
            const analyticsBtn = document.getElementById('analyticsBtn');
            if (currentUser && currentUser.role === 'admin') {
                if (settingsBtn) settingsBtn.style.display = 'flex';
                if (analyticsBtn) analyticsBtn.style.display = 'block';
            } else {
                if (settingsBtn) settingsBtn.style.display = 'none';
                if (analyticsBtn) analyticsBtn.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
            const employeeFilter = document.getElementById('employeeFilter');
            if (currentUser && currentUser.role === 'admin' && employeeFilter) {
                employeeFilter.style.display = 'flex';
                populateEmployeeFilter();
            } else if (employeeFilter) {
                employeeFilter.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            switchView('list');
            
            renderMeetings();
            setupDateInput();
            renderCalendar();
            
            // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            if (currentUser && currentUser.role === 'admin') {
                renderUsersManagement();
                renderAnalytics();
            }
        }
        
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
        function populateEmployeeFilter() {
            const select = document.getElementById('filterEmployeeSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>';
            
            USERS.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                select.appendChild(option);
            });
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—è –¥–∞—Ç—ã (—Å–µ–≥–æ–¥–Ω—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        function setupDateInput() {
            const today = new Date().toISOString().split('T')[0];
            const meetingDate = document.getElementById('meetingDate');
            if (meetingDate) {
                meetingDate.value = today;
            }
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function logout() {
            resetAppState();
            localStorage.removeItem('currentUser');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('appHeader').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
        function switchView(view) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            const listView = document.getElementById('listView');
            const calendarView = document.getElementById('calendarView');
            const analyticsView = document.getElementById('analyticsView');
            
            if (listView) listView.style.display = 'none';
            if (calendarView) calendarView.style.display = 'none';
            if (analyticsView) analyticsView.style.display = 'none';
            
            // –°–±—Ä–æ—Å–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (view === 'list' && listView) {
                listView.style.display = 'block';
                const firstBtn = document.querySelector('.view-btn:nth-child(1)');
                if (firstBtn) firstBtn.classList.add('active');
            } else if (view === 'calendar' && calendarView) {
                calendarView.style.display = 'block';
                const secondBtn = document.querySelector('.view-btn:nth-child(2)');
                if (secondBtn) secondBtn.classList.add('active');
                renderCalendar();
            } else if (view === 'analytics' && analyticsView) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
                if (currentUser && currentUser.role === 'admin') {
                    analyticsView.style.display = 'block';
                    const thirdBtn = document.querySelector('.view-btn:nth-child(3)');
                    if (thirdBtn) thirdBtn.classList.add('active');
                    renderAnalytics();
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ø–∏—Å–æ–∫
                    switchView('list');
                }
            }
        }
        
        // –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –±–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏
        function toggleAddMeetingForm() {
            const form = document.getElementById('meetingForm');
            const button = document.querySelector('.add-meeting-toggle');
            
            if (!form || !button) return;
            
            if (form.style.display === 'none' || form.style.display === '') {
                form.style.display = 'block';
                button.classList.add('active');
            } else {
                form.style.display = 'none';
                button.classList.remove('active');
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏
        async function addMeeting() {
            const clientName = document.getElementById('clientName').value.trim();
            const meetingDate = document.getElementById('meetingDate').value;
            const meetingNotes = document.getElementById('meetingNotes').value.trim();
            
            if (!clientName || !meetingDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.');
                return;
            }
            
            const newMeeting = {
                id: Date.now(),
                userId: currentUser.id,
                userName: currentUser.name,
                clientName: clientName,
                date: meetingDate,
                notes: meetingNotes,
                timestamp: new Date().toISOString()
            };
            
            await saveMeetingToFirebase(newMeeting);
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('clientName').value = '';
            document.getElementById('meetingNotes').value = '';
            setupDateInput();
            toggleAddMeetingForm();
            
            renderMeetings();
            renderCalendar();
            if (currentUser && currentUser.role === 'admin') {
                renderAnalytics();
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á –∏–∑ Firebase
        async function getMeetings() {
            return await getMeetingsFromFirebase();
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞
        async function applyFilters() {
            renderMeetings();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
        function clearSearch() {
            const searchClient = document.getElementById('searchClient');
            if (searchClient) searchClient.value = '';
            renderMeetings();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –¥–∞—Ç—ã
        function clearDateFilter() {
            const filterDate = document.getElementById('filterDate');
            if (filterDate) filterDate.value = '';
            renderMeetings();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function clearEmployeeFilter() {
            const filterEmployeeSelect = document.getElementById('filterEmployeeSelect');
            if (filterEmployeeSelect) filterEmployeeSelect.value = '';
            renderMeetings();
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ —É–º–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
        async function renderMeetings() {
            const meetingsList = document.getElementById('meetingsList');
            if (!meetingsList) return;
            
            const allMeetings = await getMeetingsFromFirebase();
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
            let filteredMeetings = allMeetings;
            
            // –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–æ–º–ø–∞–Ω–∏–∏/–∫–ª–∏–µ–Ω—Ç—É
            const searchTerm = document.getElementById('searchClient').value;
            if (searchTerm && searchTerm.trim()) {
                filteredMeetings = filteredMeetings.filter(meeting => 
                    fuzzySearch(searchTerm, meeting.clientName)
                );
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ
            const filterDate = document.getElementById('filterDate').value;
            if (filterDate) {
                filteredMeetings = filteredMeetings.filter(m => m.date === filterDate);
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
            if (currentUser && currentUser.role === 'admin') {
                const employeeFilter = document.getElementById('filterEmployeeSelect').value;
                if (employeeFilter) {
                    filteredMeetings = filteredMeetings.filter(m => m.userId == employeeFilter);
                }
            } else if (currentUser) {
                // –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –≤—Å—Ç—Ä–µ—á–∏
                filteredMeetings = filteredMeetings.filter(m => m.userId === currentUser.id);
            }
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            filteredMeetings.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredMeetings.length === 0) {
                meetingsList.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td></tr>';
                return;
            }
            
            meetingsList.innerHTML = filteredMeetings.map(meeting => `
                <tr onclick="openEditModal(${meeting.id})">
                    <td>${formatDate(meeting.date)}</td>
                    <td>${meeting.clientName}</td>
                    <td>${meeting.notes || '-'}</td>
                    <td>${meeting.userName}</td>
                    <td>
                        <button class="edit-btn" onclick="event.stopPropagation(); openEditModal(${meeting.id})">‚úèÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function openEditModal(meetingId) {
            const meetings = await getMeetingsFromFirebase();
            const meeting = meetings.find(m => m.id === meetingId);
            
            if (!meeting) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
            if (currentUser && currentUser.role !== 'admin' && meeting.userId !== currentUser.id) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –≤—Å—Ç—Ä–µ—á–∏.');
                return;
            }
            
            currentEditingMeetingId = meetingId;
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
            document.getElementById('editClientName').value = meeting.clientName;
            document.getElementById('editMeetingDate').value = meeting.date;
            document.getElementById('editMeetingNotes').value = meeting.notes || '';
            
            // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('editModal').style.display = 'flex';
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingMeetingId = null;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏
        async function saveEditedMeeting() {
            const clientName = document.getElementById('editClientName').value.trim();
            const meetingDate = document.getElementById('editMeetingDate').value;
            const meetingNotes = document.getElementById('editMeetingNotes').value.trim();
            
            if (!clientName || !meetingDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.');
                return;
            }
            
            const updatedMeeting = {
                clientName: clientName,
                date: meetingDate,
                notes: meetingNotes,
                lastModified: new Date().toISOString()
            };
            
            await updateMeetingInFirebase(currentEditingMeetingId, updatedMeeting);
            closeEditModal();
            renderMeetings();
            renderCalendar();
            if (currentUser && currentUser.role === 'admin') {
                renderAnalytics();
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏
        async function deleteMeeting() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≤—Å—Ç—Ä–µ—á—É?')) {
                return;
            }
            
            await deleteMeetingFromFirebase(currentEditingMeetingId);
            closeEditModal();
            renderMeetings();
            renderCalendar();
            if (currentUser && currentUser.role === 'admin') {
                renderAnalytics();
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ PIN
        document.getElementById('pinInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyPin();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        document.getElementById('editClientName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveEditedMeeting();
            }
        });
        
// ========== –ö–ê–õ–ï–ù–î–ê–†–¨ ==========

async function renderCalendar() {
    const calendarTitle = document.getElementById('calendarTitle');
    const calendarGrid = document.getElementById('calendarGrid');

    if (!calendarTitle || !calendarGrid) return;

    // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
    const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                      '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
    calendarTitle.textContent = `${monthNames[currentMonth]} ${currentYear}`;

    // –û—á–∏—Å—Ç–∏—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
    calendarGrid.innerHTML = '';

    // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ (—Å —É—á–µ—Ç–æ–º –≤—ã—Ö–æ–¥–Ω—ã—Ö)
    const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
    const visibleDays = hideWeekends ? dayNames.slice(0, 5) : dayNames;
    const columns = visibleDays.length;

    calendarGrid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;

    visibleDays.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day-header';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
    });

    // –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startDayOfWeek = firstDay.getDay() || 7; // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ = 0, –¥–µ–ª–∞–µ–º –µ–≥–æ 7

    // –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const userColorMap = {};
    USERS.forEach((user, index) => {
        userColorMap[user.id] = USER_COLORS[index % USER_COLORS.length];
    });

    // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤—Å—Ç—Ä–µ—á–∏
    const allMeetings = await getMeetingsFromFirebase();
    let filteredMeetings;
    if (currentUser && currentUser.role === 'admin') {
        filteredMeetings = allMeetings;
    } else if (currentUser) {
        filteredMeetings = allMeetings.filter(m => m.userId === currentUser.id);
    } else {
        filteredMeetings = [];
    }

    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–µ—á–∏ –ø–æ –¥–∞—Ç–µ
    const meetingsByDate = {};
    filteredMeetings.forEach(meeting => {
        if (!meetingsByDate[meeting.date]) {
            meetingsByDate[meeting.date] = [];
        }
        meetingsByDate[meeting.date].push(meeting);
    });

    // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è "—Å–µ–≥–æ–¥–Ω—è"
    const today = new Date();
    const todayDateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è
    function isWeekend(date) {
        const day = date.getDay();
        return day === 0 || day === 6; // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ = 0, –°—É–±–±–æ—Ç–∞ = 6
    }

    // –î–æ–±–∞–≤–∏—Ç—å –¥–Ω–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();

    if (!hideWeekends) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–Ω–∏, –≤–∫–ª—é—á–∞—è –≤—ã—Ö–æ–¥–Ω—ã–µ
        for (let i = startDayOfWeek - 1; i > 0; i--) {
            const dayNum = prevMonthLastDay - i + 1;
            const date = new Date(currentYear, currentMonth - 1, dayNum);

            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day other-month';
            if (isWeekend(date)) {
                dayDiv.classList.add('weekend');
            }
            dayDiv.innerHTML = `<span class="calendar-day-number">${dayNum}</span>`;
            calendarGrid.appendChild(dayDiv);
        }
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±—É–¥–Ω–∏–µ –¥–Ω–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        for (let i = startDayOfWeek - 1; i > 0; i--) {
            const dayNum = prevMonthLastDay - i + 1;
            const date = new Date(currentYear, currentMonth - 1, dayNum);
            if (!isWeekend(date)) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day other-month';
                dayDiv.innerHTML = `<span class="calendar-day-number">${dayNum}</span>`;
                calendarGrid.appendChild(dayDiv);
            }
        }
    }

    // –î–æ–±–∞–≤–∏—Ç—å –¥–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth, day);
        if (hideWeekends && isWeekend(date)) continue;

        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

        if (!hideWeekends && isWeekend(date)) {
            dayDiv.classList.add('weekend');
        }

        // –í—ã–¥–µ–ª–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
        if (dateStr === todayDateStr) {
            dayDiv.classList.add('today');
        }

        dayDiv.innerHTML = `<span class="calendar-day-number">${day}</span>`;

        // –î–æ–±–∞–≤–∏—Ç—å –≤—Å—Ç—Ä–µ—á–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
        if (meetingsByDate[dateStr]) {
            meetingsByDate[dateStr].forEach(meeting => {
                const meetingDiv = document.createElement('div');
                meetingDiv.className = `calendar-meeting ${userColorMap[meeting.userId] || 'color-1'}`;
                meetingDiv.title = `${meeting.clientName}: ${meeting.notes || ''}`;
                meetingDiv.textContent = meeting.clientName;
                meetingDiv.onclick = () => openEditModal(meeting.id);
                dayDiv.appendChild(meetingDiv);
            });
        }

        calendarGrid.appendChild(dayDiv);
    }

    // –î–æ–±–∞–≤–∏—Ç—å –¥–Ω–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (—á—Ç–æ–±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Å–µ—Ç–∫—É)
    if (!hideWeekends) {
        const totalCells = 42; // 6 –Ω–µ–¥–µ–ª—å * 7 –¥–Ω–µ–π
        const currentCells = calendarGrid.children.length;
        const nextMonthDays = totalCells - currentCells;
        const nextMonthFirstDay = new Date(currentYear, currentMonth + 1, 1);

        for (let day = 1; day <= nextMonthDays; day++) {
            const date = new Date(currentYear, currentMonth + 1, day);

            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day other-month';
            if (isWeekend(date)) {
                dayDiv.classList.add('weekend');
            }
            dayDiv.innerHTML = `<span class="calendar-day-number">${day}</span>`;
            calendarGrid.appendChild(dayDiv);
        }
    } else {
        // –î–ª—è –±—É–¥–Ω–∏—Ö –¥–Ω–µ–π —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–µ–ª—å –ø–æ-–¥—Ä—É–≥–æ–º—É
        const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
        const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);

        // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–¥–Ω–∏—Ö –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
        let weekdaysCount = 0;
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(currentYear, currentMonth, day);
            if (!isWeekend(date)) {
                weekdaysCount++;
            }
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å (–º–∞–∫—Å–∏–º—É–º 6)
        const weeksNeeded = Math.ceil((calendarGrid.children.length + (5 - (calendarGrid.children.length % 5 || 5))) / 5);
        const maxWeeks = 6;
        const totalCells = Math.min(weeksNeeded * 5, maxWeeks * 5);
        const currentCells = calendarGrid.children.length;
        const nextMonthDays = totalCells - currentCells;

        for (let day = 1; day <= nextMonthDays; day++) {
            const date = new Date(currentYear, currentMonth + 1, day);
            if (!isWeekend(date)) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day other-month';
                dayDiv.innerHTML = `<span class="calendar-day-number">${day}</span>`;
                calendarGrid.appendChild(dayDiv);
            }
        }
    }
}
        
        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }
        
        // –ö–Ω–æ–ø–∫–∞ "–°–µ–≥–æ–¥–Ω—è"
        function goToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar();
            
            // –ù–∞–π—Ç–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é
            setTimeout(() => {
                const todayElements = document.querySelectorAll('.calendar-day.today');
                if (todayElements.length > 0) {
                    todayElements[0].classList.add('highlight');
                    setTimeout(() => {
                        todayElements[0].classList.remove('highlight');
                    }, 1500);
                }
            }, 100);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Ö–æ–¥–Ω—ã—Ö
        function toggleWeekends() {
            hideWeekends = !hideWeekends;
            const button = event.target;
            if (button) {
                button.textContent = hideWeekends ? '–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ' : '–°–∫—Ä—ã—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ';
            }
            renderCalendar();
        }
        
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        
        function toggleSettings() {
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
            if (currentUser && currentUser.role === 'admin') {
                const panel = document.getElementById('settingsPanel');
                const overlay = document.getElementById('settingsOverlay');
                if (panel && overlay) {
                    panel.classList.toggle('open');
                    overlay.classList.toggle('active');
                }
            }
        }
        
        function toggleSettingsSection(sectionId) {
            const content = document.getElementById(sectionId + 'Settings');
            if (!content) return;
            
            const isActive = content.classList.contains('active');
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.settings-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            if (!isActive) {
                content.classList.add('active');
            }
        }
        
        // –°–º–µ–Ω–∞ PIN-–∫–æ–¥–∞
        function changePin() {
            const newPin = document.getElementById('newPin').value;
            const confirmPin = document.getElementById('confirmPin').value;
            const messageDiv = document.getElementById('pinChangeMessage');
            
            if (!newPin || !confirmPin || !messageDiv) return;
            
            if (newPin.length !== 4 || confirmPin.length !== 4) {
                messageDiv.textContent = 'PIN-–∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4 —Ü–∏—Ñ—Ä—ã';
                messageDiv.style.display = 'block';
                return;
            }
            
            if (newPin !== confirmPin) {
                messageDiv.textContent = 'PIN-–∫–æ–¥—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                messageDiv.style.display = 'block';
                return;
            }
            
            if (!/^\d{4}$/.test(newPin)) {
                messageDiv.textContent = 'PIN-–∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã';
                messageDiv.style.display = 'block';
                return;
            }
            
            // –ù–∞–π—Ç–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ PIN
            const userIndex = USERS.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                USERS[userIndex].pin = newPin;
                saveUsersToFirebase();
                messageDiv.textContent = 'PIN-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!';
                messageDiv.style.color = '#28a745';
                messageDiv.style.display = 'block';
                
                // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è
                document.getElementById('newPin').value = '';
                document.getElementById('confirmPin').value = '';
                
                // –°–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                    messageDiv.style.color = '#dc3545';
                }, 3000);
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function addUser() {
            const userName = document.getElementById('newUserName').value.trim();
            const userRole = document.getElementById('newUserRole').value;
            const userPin = document.getElementById('newUserPin').value.trim();
            
            if (!userName) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (USERS.some(u => u.name.toLowerCase() === userName.toLowerCase())) {
                alert('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è PIN (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
            let pin = null;
            if (userPin) {
                if (userPin.length !== 4 || !/^\d{4}$/.test(userPin)) {
                    alert('PIN-–∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4 —Ü–∏—Ñ—Ä—ã');
                    return;
                }
                pin = userPin;
            }
            
            const newId = Math.max(...USERS.map(u => u.id)) + 1;
            USERS.push({
                id: newId,
                name: userName,
                role: userRole,
                pin: pin
            });
            
            saveUsersToFirebase();
            renderUsers();
            renderUsersManagement();
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserPin').value = '';
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function deleteUser(userId) {
            if (USERS.length <= 1) {
                alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }
            
            const userToDelete = USERS.find(u => u.id === userId);
            if (userToDelete.role === 'admin' && USERS.filter(u => u.role === 'admin').length === 1) {
                alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è');
                return;
            }
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ "${userToDelete.name}"?`)) {
                // –£–¥–∞–ª–∏—Ç—å –≤—Å—Ç—Ä–µ—á–∏ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const meetingsRef = database.ref('meetings');
                meetingsRef.once('value', (snapshot) => {
                    const meetings = snapshot.val();
                    if (meetings) {
                        const keysToDelete = [];
                        Object.keys(meetings).forEach(key => {
                            if (meetings[key].userId == userId) {
                                keysToDelete.push(key);
                            }
                        });
                        keysToDelete.forEach(key => {
                            meetingsRef.child(key).remove();
                        });
                    }
                });
                
                // –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                USERS = USERS.filter(u => u.id !== userId);
                saveUsersToFirebase();
                renderUsers();
                renderUsersManagement();
                renderMeetings();
                renderCalendar();
                if (currentUser && currentUser.role === 'admin') {
                    renderAnalytics();
                }
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        function renderUsersManagement() {
            const container = document.getElementById('usersManagement');
            if (!container) return;
            
            container.innerHTML = '';
            
            USERS.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div>
                        <strong>${user.name}</strong>
                        <br>
                        <small>${user.role === 'admin' ? '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫'}${user.pin ? ' üîí' : ''}</small>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})" 
                            ${USERS.length <= 1 ? 'disabled' : ''}>
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                `;
                container.appendChild(userDiv);
            });
        }
    </script>
</body>
</html>